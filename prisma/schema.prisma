generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Memorial {
  id          String   @id @default(cuid())
  slug        String   @unique
  
  // Subject Info
  fullName    String
  birthDate   String
  deathDate   String
  epitaph     String
  
  // Content
  bio         String
  mainImage   String
  gallery     String // Store as JSON string since SQLite doesn't support JSON type natively in all versions, or use simple string
  
  // Blockchain Anchor
  txid        String?  @unique
  status      String   @default("DRAFT") // DRAFT, PENDING, ANCHORED
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Payment Relation
  paymentStatus String   @default("UNPAID") // UNPAID, PAID
  payments      Payment[]
}

model Payment {
  id          String   @id @default(cuid())
  amount      Int      // In sats or cents
  currency    String   @default("USD")
  status      String   @default("PENDING") // PENDING, COMPLETED, FAILED
  providerId  String?  // ID from external provider (e.g., Stripe, BTCPay)
  
  memorialId  String
  memorial    Memorial @relation(fields: [memorialId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
